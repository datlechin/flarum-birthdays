(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var a in e)t.o(e,a)&&!t.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:e[a]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o);const e=flarum.core.compat["forum/app"];var a=t.n(e);const r=flarum.core.compat["common/extend"],n=flarum.core.compat["common/models/User"];var s=t.n(n);const i=flarum.core.compat["common/Model"];var c=t.n(i);const h=flarum.core.compat["forum/components/SettingsPage"];var l=t.n(h);const d=flarum.core.compat["forum/components/UserCard"];var p=t.n(d);const u=flarum.core.compat["forum/components/SessionDropdown"];var b=t.n(u);const f=flarum.core.compat["common/components/Button"];var y=t.n(f);const D=flarum.core.compat["common/helpers/icon"];var w=t.n(D);function g(t,o){return g=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t},g(t,o)}const v=flarum.core.compat["common/components/Modal"];var _=t.n(v);const Y=flarum.core.compat["common/components/Switch"];var N=t.n(Y);const S=flarum.core.compat["common/utils/Stream"];var x=t.n(S),F=function(t){var o,e;function a(){return t.apply(this,arguments)||this}e=t,(o=a).prototype=Object.create(e.prototype),o.prototype.constructor=o,g(o,e);var r=a.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o);var e=app.session.user;this.birthday=x()(e.birthday()),this.showDobDate=x()(e.preferences().showDobDate),this.showDobYear=x()(e.preferences().showDobYear)},r.className=function(){return"ChangeBirthdayModal Modal--small"},r.title=function(){return app.translator.trans("datlechin-birthdays.forum.change_dob.title")},r.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,app.translator.trans("datlechin-birthdays.forum.change_dob.date_of_birth_text")),m("input",{type:"date",name:"birthday",className:"FormControl",bidi:this.birthday,disabled:this.loading})),m("div",{className:"Form-group"},N().component({state:this.showDobDate(),onchange:this.showDobDate},app.translator.trans("datlechin-birthdays.forum.change_dob.show_dob_date"))),m("div",{className:"Form-group"},N().component({state:this.showDobDate()&&this.showDobYear(),onchange:this.showDobYear},app.translator.trans("datlechin-birthdays.forum.change_dob.show_dob_year")),m("div",{className:"helpText"},app.translator.trans("datlechin-birthdays.forum.change_dob.show_dob_year_help"))),m("div",{className:"Form-group"},y().component({className:"Button Button--primary",type:"submit",loading:this.loading},app.translator.trans("datlechin-birthdays.forum.change_dob.submit_button")))))},r.onsubmit=function(t){var o=this;t.preventDefault(),this.birthday()!==app.session.user.birthday()||this.showDobDate()!==app.session.user.preferences().showDobDate||this.showDobYear()!==app.session.user.preferences().showDobYear?(this.loading=!0,this.alertAttrs=null,app.session.user.save({birthday:this.birthday()},{errorHandler:this.onerror.bind(this)}).then((function(){o.success=!0,o.hide()})).catch((function(){})).then(this.loaded.bind(this)),this.showDobDate()===app.session.user.preferences().showDobDate&&this.showDobYear()===app.session.user.preferences().showDobYear||app.session.user.savePreferences({showDobDate:this.showDobDate(),showDobYear:this.showDobYear()})):this.hide()},r.onerror=function(o){t.prototype.onerror.call(this,o)},a}(_());a().initializers.add("datlechin/flarum-birthdays",(function(){s().prototype.birthday=c().attribute("birthday"),s().prototype.showDobDate=c().attribute("showDobDate"),s().prototype.showDobYear=c().attribute("showDobYear"),(0,r.extend)(l().prototype,"accountItems",(function(t){t.add("changeBirthday",m(y(),{className:"Button",onclick:function(){return a().modal.show(F)}},a().translator.trans("datlechin-birthdays.forum.change_dob.title")))})),(0,r.extend)(p().prototype,"infoItems",(function(t){var o,e=this.attrs.user,r=e.preferences(),n=r.locale||"en",s=e.birthday(),i=new Date(s),c={month:"long",day:"numeric",year:"numeric"};if("0000-00-00"!==s){if(r.showDobDate&&r.showDobYear)o=(new Date).getFullYear()-new Date(s).getFullYear(),s=i.toLocaleDateString(n,c);else{if(!0!==r.showDobDate||!1!==r.showDobYear)return;s=(s=i.toLocaleDateString(n,c)).split(",")[0]}t.add("birthday",m("[",null,w()("fas fa-birthday-cake"),m("span",{className:"birthday"},a().translator.trans("datlechin-birthdays.forum.user.birthday_text",{date:s})),r.showDobYear?m("span",{className:"age"},"(",a().translator.trans("datlechin-birthdays.forum.user.age_text",{age:o}),")"):null))}})),(0,r.extend)(b().prototype,"items",(function(t){t.add("birthday",m(y(),{icon:"fas fa-birthday-cake",onclick:function(){return a().modal.show(F)}},a().translator.trans("datlechin-birthdays.forum.header.edit_dob_button")))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map