(()=>{var t={n:a=>{var o=a&&a.__esModule?()=>a.default:()=>a;return t.d(o,{a:o}),o},d:(a,o)=>{for(var r in o)t.o(o,r)&&!t.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:o[r]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a);const o=flarum.core.compat["forum/app"];var r=t.n(o);const e=flarum.core.compat["common/extend"],n=flarum.core.compat["common/models/User"];var s=t.n(n);const i=flarum.core.compat["common/Model"];var d=t.n(i);const c=flarum.core.compat["forum/components/SignUpModal"];var h=t.n(c);const l=flarum.core.compat["common/components/EditUserModal"];var u=t.n(l);const b=flarum.core.compat["common/components/Button"];var p=t.n(b);const y=flarum.core.compat["common/components/SettingsPage"];var f=t.n(y);const g=flarum.core.compat["common/components/FieldSet"];var D=t.n(g);const v=flarum.core.compat["common/components/Switch"];var w=t.n(v);const _=flarum.core.compat["common/utils/Stream"];var N=t.n(_);const x=flarum.core.compat["forum/components/UserCard"];var S=t.n(x);const Y=flarum.core.compat["common/helpers/icon"];var F=t.n(Y);function O(t,a){return O=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t},O(t,a)}const M=flarum.core.compat["common/components/Modal"];var B=function(t){var a,o;function r(){return t.apply(this,arguments)||this}o=t,(a=r).prototype=Object.create(o.prototype),a.prototype.constructor=a,O(a,o);var e=r.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.birthday=N()(app.session.user.birthday())},e.className=function(){return"ChangeBirthdayModal Modal--small"},e.title=function(){return app.translator.trans("datlechin-birthdays.forum.change_dob.title")},e.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,app.translator.trans("datlechin-birthdays.forum.change_dob.date_of_birth_text")),m("input",{type:"date",name:"birthday",className:"FormControl",bidi:this.birthday,disabled:this.loading})),m("div",{className:"Form-group"},p().component({className:"Button Button--primary",type:"submit",loading:this.loading},app.translator.trans("datlechin-birthdays.forum.change_dob.submit_button")))))},e.onsubmit=function(t){var a=this;t.preventDefault(),this.birthday()!==app.session.user.birthday()?(this.loading=!0,this.alertAttrs=null,app.session.user.save({birthday:this.birthday()},{errorHandler:this.onerror.bind(this)}).then((function(){a.success=!0,a.hide()})).catch((function(){})).then(this.loaded.bind(this))):this.hide()},e.onerror=function(a){t.prototype.onerror.call(this,a)},r}(t.n(M)());r().initializers.add("datlechin/flarum-birthdays",(function(){s().prototype.birthday=d().attribute("birthday"),s().prototype.showDobDate=d().attribute("showDobDate"),s().prototype.showDobYear=d().attribute("showDobYear"),(0,e.extend)(S().prototype,"infoItems",(function(t){var a,o,e=this.attrs.user,n=(null==(a=e.preferences())?void 0:a.locale)||r().translator.formatter.locale,s=e.birthday(),i=new Date(s),d={month:"long",day:"numeric",year:"numeric"};if("0000-00-00"!==s&&""!==s){if(e.showDobDate()&&e.showDobYear())o=(new Date).getFullYear()-new Date(s).getFullYear(),s=i.toLocaleDateString(n,d);else{if(!0!==e.showDobDate()||!1!==e.showDobYear())return;s=(s=i.toLocaleDateString(n,d)).split(",")[0]}t.add("birthday",m("[",null,F()("fas fa-birthday-cake"),m("span",{className:"birthday"},r().translator.trans("datlechin-birthdays.forum.user.birthday_text",{date:s})),e.showDobYear()?m("span",{className:"age"},"(",r().translator.trans("datlechin-birthdays.forum.user.age_text",{age:o}),")"):null))}})),(0,e.extend)(u().prototype,"oninit",(function(){this.birthday=N()(this.attrs.user.birthday())})),(0,e.extend)(u().prototype,"fields",(function(t){t.add("birthday",m("div",{className:"Form-group"},m("label",null,r().translator.trans("datlechin-birthdays.forum.edit_user.birthdays_heading")),m("input",{className:"FormControl",type:"date",bidi:this.birthday})),30)})),(0,e.extend)(u().prototype,"data",(function(t){this.birthday()!==this.attrs.user.birthday()&&(t.birthday=this.birthday())})),(0,e.extend)(h().prototype,"oninit",(function(){r().forum.attribute("setBirthdayOnRegistration")&&(this.birthday=N()(this.attrs.birthday||""))})),(0,e.extend)(h().prototype,"fields",(function(t){r().forum.attribute("setBirthdayOnRegistration")&&t.add("birthday",m("div",{className:"Form-group"},m("input",{className:"FormControl birthday",name:"birthday",type:"date",bidi:this.birthday,disabled:this.loading})),20)})),(0,e.extend)(h().prototype,"submitData",(function(t){r().forum.attribute("setBirthdayOnRegistration")&&(t.birthday=this.birthday())})),(0,e.extend)(f().prototype,"settingsItems",(function(t){var a=this;t.add("birthday",m(D(),{className:"Settings-birthday",label:r().translator.trans("datlechin-birthdays.forum.settings.birthday_heading")},m(w(),{state:this.user.showDobDate(),onchange:function(t){a.showDobDateLoading=!0,a.user.save({showDobDate:t}).then((function(){a.showDobDateLoading=!1,m.redraw()}))},loading:this.showDobDateLoading},r().translator.trans("datlechin-birthdays.forum.settings.show_dob_date_label")),m(w(),{state:this.user.showDobDate()&&this.user.showDobYear(),onchange:function(t){a.showDobYearLoading=!0,a.user.save({showDobYear:t}).then((function(){a.showDobYearLoading=!1,m.redraw()}))},loading:this.showDobYearLoading},r().translator.trans("datlechin-birthdays.forum.settings.show_dob_year_label")),m("span",{className:"helpText"},r().translator.trans("datlechin-birthdays.forum.settings.show_dob_year_help"))))})),(0,e.extend)(f().prototype,"accountItems",(function(t){t.add("changeBirthday",m(p(),{className:"Button",onclick:function(){return r().modal.show(B)}},r().translator.trans("datlechin-birthdays.forum.settings.change_dob_label")))}))}))})(),module.exports=a})();
//# sourceMappingURL=forum.js.map